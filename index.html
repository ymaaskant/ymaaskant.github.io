<!DOCTYPE html>
<html>
  <head>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>

    <script>
      const disableButton = () => {
        const button = document.querySelector("#buttonRoll");
        button.disabled = true;
      };

      const enableButton = () => {
        const button = document.querySelector("#buttonRoll");
        button.disabled = false;
      };

      const boardSpot = [
        { x: -1, y: 1, z: 3, type:"start"},
        { x: -0.125, y: 1.05, z: 3, type:"green"},
        { x: 0.33, y: 1, z: 3, type:"green"},
        { x: 0.75, y: 0.666, z: 3, type:"reset"},
        { x: 0.75, y: 0.25, z: 2.2, type:"trap"},
        { x: 1.25, y: 0.25, z: 1.875, type:"trap"},
        { x: 1.75, y: 0.25, z: 1.55, type:"trap"},
        { x: 2.25, y: 0.25, z: 1.2, type:"trap"},
        { x: 2.75, y: 0.25, z: 0.85, type:"trap"},
        { x: 3.5, y: 0.25, z: 0.35, type:"trap"},
        { x: 3.2, y: 0.9, z: 0, type:"green"},
        { x: 3.18, y: 1.4, z: 0, type:"green"},
        { x: 2.85, y: 1.75, z: 0, type:"green"},
        { x: 2.45, y: 1.7, z: 0, type:"yellow"},
        { x: 1.6, y: 1.65, z: 0, type:"green"},
        { x: 1.5, y: 1.65, z: 0, type:"green"},
        { x: 1.1, y: 1.8, z: 0, type:"yellow"},
        { x: 0.73, y: 2, z: 0, type:"green"},
        { x: 0.2, y: 2, z: 0, type:"green"},
        { x: -0.3, y: 2, z: 0, type:"reset"},
        { x: -0.78, y: 1.7, z: 0, type:"green"},
        { x: -0.9, y: 1.25, z: 0, type:"green"},
      ];

      var p1Spot = 0;
      var p2Spot = 0;
      var p1NewSpot = 0;
      var p2NewSpot = 0;
      var playerTurn = 1;
      const finish = 25;

      const roll = () => {
        disableButton();
        var randomNumber = Math.floor(Math.random() * 6) + 1;
        console.log("rolled: " + randomNumber);
        playerMove(playerTurn, randomNumber);
        return randomNumber;
      };

      const animationTimer = (ms) => new Promise((res) => setTimeout(res, ms));




      async function playerMove(player, roll) {
        if (player === 1) {
          var player = document.querySelector("#player01");
          var playerOldSpot = p1Spot;
          var playerNewSpot = p1Spot + roll;
          if(playerNewSpot === p2Spot){
            playerNewSpot++;
          }
          p1Spot = playerNewSpot;
          playerTurn = 2;
        } else if (player === 2) {
          var player = document.querySelector("#player02");
          var playerOldSpot = p2Spot;
          var playerNewSpot = p2Spot + roll;
          if(playerNewSpot === p1Spot){
            playerNewSpot++;
          }
          p2Spot = playerNewSpot;
          playerTurn = 1;
        }

        if (playerNewSpot > finish) {
          playerNewSpot = finish;
          console.log("player wins");
        }

        player.setAttribute("animation","to",{
          x:boardSpot[playerOldSpot].x,
          y:boardSpot[playerOldSpot].z + 0.5,
          z: boardSpot[playerOldSpot].y
        });


        for (var i = playerOldSpot; i < playerNewSpot+1; i++) {
          await animationTimer(600);
          player.setAttribute("animation", "to", {
            x: boardSpot[i].x,
            y: boardSpot[i].z + 0.5,
            z: boardSpot[i].y,
          });
        }
        await animationTimer(600);
        player.setAttribute("animation","to",{
          x: boardSpot[playerNewSpot].x,
          y: boardSpot[playerNewSpot].z,
          z: boardSpot[playerNewSpot].y
        });

        if(boardSpot[playerNewSpot].type === "trap"){
          var randomNumber = Math.floor(Math.random() * 4) + 1;
          console.log(randomNumber);
          if (randomNumber === 1 ){

            var resetSpot = 3  
            
            player.setAttribute("animation","to",{
              x:boardSpot[playerNewSpot].x,
              y:boardSpot[resetSpot].z + 0.5,
              z: boardSpot[playerNewSpot].y
            });
            await animationTimer(600);
            player.setAttribute("animation","to",{
              x:boardSpot[resetSpot].x,
              y:boardSpot[resetSpot].z + 0.5,
              z: boardSpot[resetSpot].y
            });
            await animationTimer(600);
            player.setAttribute("animation","to",{
              x:boardSpot[resetSpot].x,
              y:boardSpot[resetSpot].z,
              z: boardSpot[resetSpot].y
            });
            await animationTimer(600);
          }
        }


        console.log("p1Spot: " + p1Spot + " p2Spot: " + p2Spot);
        enableButton();
      }
    </script>

    <style>
      body {
        background-color: black;
      }
      .btn-container {
        display: block;
        position: fixed;
        bottom: 1rem;
        width: 100%;
      }
      .btn {
        display: flex;
        height: 60px;
        background-color: #1e6eb3;
        padding-left: 20px;
        padding-right: 20px;
        margin: 0 auto;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        width: 300px;
      }
      .btn span {
        font-family: "Open Sans", Helvetica, Arial, Lucida, sans-serif;
        font-weight: 800;
        text-transform: uppercase;
        font-size: 19px;
        color: #000000;
        transition: color 300ms ease 0ms;
        -webkit-box-align: center;
        -ms-flex-align: center;
        align-items: center;
        padding: 31px 0;
        white-space: nowrap;
        display: flex;
        vertical-align: center;
      }
      .btn:hover span {
        color: #000000 !important;
      }
      a {
        text-decoration: none;
      }
    </style>
  </head>
  <body>
    <a-scene effects="bloom, fxaa" bloom="radius:2" fxaa height="1200px">
      <!-- assets -->
      <a-assets>
        <img id="board_5x5" src="https://ymaaskant.github.io/docs/assets/images/Textures/5x5.png"
        />
        <img id="tx_p_b_1" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_c_b1.png"/>
        <img id="tx_p_b_2" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_c_b2.png"/>
        <img id="tx_p_g_1" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_c_g1.png"/>
        <img id="tx_p_g_2" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_c_g2.png"/>
        <img id="tx_p_y_1" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_c_y1.png"/>
        <img id="tx_p_y_2" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_c_y2.png"/>
        <img id="tx_p_p_1" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_c_p1.png"/>
        <img id="tx_p_p_2" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_c_p2.png"/>

        <img id="tx_board_base" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_board_base.png"/>
        <img id="tx_board_top" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_board_top.png"/>
        <img id="tx_wall1_g_y" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_w1_green_yellow.png"/>
        <img id="tx_wall1_b_p" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_w1_blue_pink.png"/>
        <img id="tx_wall2_g_p" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_w2_green_pink.png"/>
        <img id="tx_wall2_y_b" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_w2_yellow_blue.png"/>
        <img id="tx_tower_1" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_tower_1.png"/>
        <img id="tx_tower_2" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_tower_2.png"/>
        <img id="tx_tower_3" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_tower_3.png"/>
        <img id="tx_stairs" src="https://ymaaskant.github.io/docs/assets/images/Textures/texture_stairs.png"/>

        
        <!-- <a-plane
          id="SciFi_Panel_01"
          height="4"
          width="4"
          rotation="0 0 0"
          position="0 2 -4"
          material="src:#texture_jsp_solid; ambientOcclusionMap: #texture_jsp_AO; displacementMap: #texture_jsp_height; normalMap:#texture_jsp_normal; roughnessMap: #texture_jsp_roughness; metalnessMap:#texture_jsp_metallic; side:double;"
        ></a-plane> -->
      </a-assets>

      <!-- scene population -->
      <!-- environment -->
      <a-sky color="#131d2c"></a-sky>

        <!-- Player Models -->    
      <a-entity
        id="player01" position="-1 3 1" animation="property:position; loop: 1; dir:normal; dur:500;">
        <a-cone radius-bottom="0.2" radius-top="0.15" height="0.2" position="0 0.1 0" color="blue"></a-cone>
        <a-plane src="#tx_p_b_1" scale="0.5 1.2 1" position="0 0.6 0" material="transparent:true"></a-plane>
      </a-entity>

      <a-entity id="player02" position="-1 3 0.5" animation="property:position; loop: 1; dir:normal; dur:500;">
        <a-cone radius-bottom="0.2" radius-top="0.15" height="0.2" position="0 0.1 0" color="purple"></a-cone>
        <a-plane src="#tx_p_p_1" scale="0.5 1.2 1" position="0 0.6 0" material="transparent:true"></a-plane>
      </a-entity>

      <!-- game board -->
      <a-entity id="board" position="0 0 0" rotation="0 180 0">
        <a-plane src="#tx_board_base" scale="8.2 5 1" position="0 0 0" rotation="-90 0 0 "></a-plane>
        <a-plane src="#tx_board_top" scale="2.5 2.5 1" position="0.125 3 -0.6" rotation="-90 180 0 "material="transparent: true"></a-plane>
        <a-plane src="#tx_wall1_g_y" scale="9 3 1" position="0 1.5 0" rotation="0 180 0" material="transparent: true"></a-plane>
        <a-plane src="#tx_wall1_b_p" scale="-9 3 1" position="0 1.5 0" rotation="0 0 0" material="transparent:true"></a-plane>
        <a-plane src="#tx_wall2_g_p" scale="6.25 3 1" position="0 1.5 0" rotation="0 270 0" material="transparent:true"></a-plane>
        <a-plane src="#tx_wall2_y_b" scale="6.25 3 1" position="0 1.5 0" rotation="0 90 0" material="transparent:true"></a-plane>
        <a-plane src="#tx_stairs" scale="3.5 3.5 1" position="-1.275 1.75 -0.5" rotation="0 180 0" material="transparent:true"></a-plane>
        <a-plane src="#tx_tower_1" scale="1 3.5 1" position="-0.5 1.75 0" rotation="0 270 0" material="transparant:true"></a-plane>
        <a-plane src="#tx_tower_2" scale="1 3.5 1" position="0 1.75 0.5" rotation="0 0 0" material="transparant:true"></a-plane>
        <a-plane src="#tx_tower_3" scale="1 3.5 1" position="0.5 1.75 0" rotation="0 90 0" material="transparant:true"></a-plane>
        <a-plane scale="0.5 0.5 1" position = "-0.7875 2.2 -0.25" rotation="-90 0 0" material="color:black"></a-plane>
        <a-plane scale="0.5 0.5 1" position = "-1.25 1.875 -0.25" rotation="-90 0 0" material="color:black"></a-plane>
        <a-plane scale="0.5 0.5 1" position = "-1.75 1.55 -0.25" rotation="-90 0 0" material="color:black"></a-plane>
        <a-plane scale="0.5 0.5 1" position = "-2.25 1.2 -0.25" rotation="-90 0 0" material="color:black"></a-plane>
        <a-plane scale="0.5 0.5 1" position = "-2.75 0.85 -0.25" rotation="-90 0 0" material="color:black"></a-plane>
        <a-plane scale="1.2 0.5 1" position = "-3.5  0.35 -0.25" rotation="-90 0 0" material="color:black"></a-plane>
      </a-entity>
        


      <!-- camera -->
      <a-entity id="cameraRig" position="0 4 8" rotation="0 0 0">
        <a-camera
          id="camera01"
          active="true"
          wasd-controls.enabled="true"
          position="0 0 0"
          rotation="-15 0 0"
          fov="35"
        ></a-camera>
      </a-entity>
    </a-scene>
    <div class="btn-container">
      <button id="buttonRoll" class="btn" onclick="roll()">
        <span>Roll</span>
      </button>
    </div>
  </body>
</html>

<!-- npm i -g five-server@latest && five-server --port=8000 -->
